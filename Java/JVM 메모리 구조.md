# JVM 메모리 구조

## JVM이란

- Java Virtual Machine의 약자로 자바 바이트코드를 실행할 수 있는 주체이다.
- 자바 소스코드를 바로 실행할 수 없으며, 바이트코드로 컴파일하여 실행할 수 있다.

## JVM 장단점

### 장점

- 운영체제별로 따로 실행하고 관리하는 방법이 다르기에 별도로 운영체제와 자바 프로그램을 실행하고 관리하는 것이 아닌, 중계하는 JVM을 둬서 여러 운영체제에서 동일한 실행 결과를 나타낸다.
- 즉, 한번 프로그램을 작성하면 어디서든 사용가능하다는 장점을 가진다.

### 단점

- 운영체제에 종속적이므로, 각 운영체제에 맞는 JVM을 설치해야 한다.
- 일반 프로그램보다 JVM이라는 한 단계를 더 거쳐야 하기 때문에 상대적으로 실행 속도가 느리다는 단점을 가진다.

## JVM 구조

![JVM](https://user-images.githubusercontent.com/47625368/120814841-37f69e00-c58a-11eb-9c6c-3763cd15cd07.png)

- JVM은 크게 4가지(Class Loader, Execution Engine, Garbage Collector, Runtime Data Area)로 나뉜다.

### 전체적인 흐름(Java 동작 과정)

1. Java 소스(.java 파일)가 자바 컴파일러(javac)에 의해 Java Byte Code(.class 파일)로 변경된다.
2. JVM의 Class Loader가 컴파일된 바이트 코드를 Runtime Data Area에 로드한다.
3. Execution Engine이 바이트 코드를 수행한다.

### Class Loader

- 자바 컴파일러에 의해 생성된 바이트 코드(.class 파일)들을 JVM이 운영체제로부터 할당받은 메모리영역인 Runtime Data Area에 적재하는 역할을 한다.

### Execution Engine

- Class Loader에 의해 메모리에 적재된 바이트 코드를 기계어로 변경해 명령어 단위로 실행하는 역할을 한다.
- 명령어를 실행하는 방식
  - 인터프리터 방식
    - 한번에 하나의 바이트코드를 실행한다.
  - JIT(Just-In-Time) 컴파일러
    - 적절한 시간에 전체 바이트코드를 네이티브 코드로 변경하여 Execution Engine이 네이티브로 컴파일된 코드를 실행함으로써 성능을 높이는 방식이다.
    - 이처럼 미리 플랫폼이 이해할 수 있는 기계어로 컴파일 해놓고 캐싱되어, 마치 처음부터 그 플랫폼에서 컴파일된 것처럼 보이기 때문에 성능이 향상될 수 있다.

### Garbage Collector

- 힙 메모리 영역에 생성된 객체들 중 참조되지 않은 객체들을 탐색 후 제거하는 역할을 한다.
- 참조가 없어진 후, 바로 해제되는 것을 보장하지 않기 때문에 GC가 역할을 하는 시간은 정확히 모른다.
- GC가 수행되는 동안 GC를 수행하는 쓰레드 이외의 다른 모든 쓰레드는 일시정지된다.

### Runtime Data Area

- JVM 메모리 영역으로 자바 애플리케이션을 실행할 때 사용되는 데이터들을 적재하는 영역이다.
- Method Area(메소드 영역)
  - 클래스 멤버 변수의 이름, 데이터 타입, 접근 제어자 정보 등의 필드 정보.
  - 메소드의 이름, 리턴 타입, 파라미터, 접근 제어자 정보 등의 메소드 정보.
  - Type 정보, Constant Pool, static 변수, final class 변수 등.
- Heap Area(힙 영역)
  - new 키워드로 생성된 객체와 배열이 생성되는 영역이다.
  - 메소드 영역에 적재된 클래스만 생성 가능하고, Garbage Collector가 참조되지 않은 메모리를 확인하고 제거한다.
- Stack Area(스택 영역)
  - 지역 변수, 파라미터, 리턴 값, 연산에 사용되는 임시 값 등이 생성되는 영역이다.
- PC Register(PC 레지스터)
  - 쓰레드가 생성될 때마다 생성되는 영역이다.(Program Counter)
  - 즉, 현재 쓰레드가 실행되는 부분의 주소와 명령을 저장하는 영역.
- Native Method Stack
  - 자바 외 언어로 작성된 네이티브 코드를 위한 메모리 영역이다.
  - 보통 c/c++ 등의 코드를 수행하기 위한 스택
